#!/usr/bin/env python3
"""
GitHub Repository Creator and File Uploader using PyGithub
"""

import os
import base64
from github import Github, InputFileContent

# Configuration
TOKEN = "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"
REPO_NAME = "ceemdan-long-series"
DESCRIPTION = "Extended CEEMDAN for long time-series analysis (13+ IMFs)"
LOCAL_DIR = r"E:\Master's degree\毕业论文\data\baseline\PV_baseline\github_release"

def main():
    print("="*70)
    print("GitHub Upload Script (PyGithub)")
    print("="*70)
    
    # Connect to GitHub
    g = Github(TOKEN)
    user = g.get_user()
    print(f"\nLogged in as: {user.login}")
    
    # Check if repo exists
    try:
        repo = user.get_repo(REPO_NAME)
        print(f"Repository already exists: https://github.com/{user.login}/{REPO_NAME}")
        existing = True
    except:
        existing = False
    
    # Create repository if not exists
    if not existing:
        print(f"\nCreating repository: {REPO_NAME}")
        try:
            repo = user.create_repo(
                name=REPO_NAME,
                description=DESCRIPTION,
                license_template="gpl-2.0",
                auto_init=True
            )
            print(f"Repository created: https://github.com/{user.login}/{REPO_NAME}")
        except Exception as e:
            print(f"Failed to create repository: {e}")
            return
    else:
        repo = user.get_repo(REPO_NAME)
    
    # Get list of files to upload
    files_to_upload = []
    for root, dirs, files in os.walk(LOCAL_DIR):
        if '.git' in root:
            continue
        for file in files:
            filepath = os.path.join(root, file)
            rel_path = os.path.relpath(filepath, LOCAL_DIR)
            files_to_upload.append(rel_path)
    
    print(f"\nFound {len(files_to_upload)} files to upload:")
    for f in sorted(files_to_upload):
        print(f"  - {f}")
    
    # Upload files
    print("\n" + "-"*70)
    print("Uploading files...")
    success = 0
    failed = 0
    
    for rel_path in sorted(files_to_upload):
        filepath = os.path.join(LOCAL_DIR, rel_path)
        try:
            with open(filepath, 'rb') as f:
                content = f.read()
            
            # Check file size
            size_mb = len(content) / (1024 * 1024)
            if size_mb > 100:
                print(f"  [SKIP] {rel_path}: {size_mb:.1f}MB (too large)")
                continue
            
            # Encode content
            encoded = base64.b64encode(content).decode('utf-8')
            
            # Get SHA if file exists
            try:
                existing = repo.get_contents(rel_path)
                sha = existing.sha
                action = "Update"
                result = repo.update_file(rel_path, f"Update {rel_path}", encoded, sha)
            except:
                action = "Create"
                result = repo.create_file(rel_path, f"Add {rel_path}", encoded)
            
            print(f"  [{action}] {rel_path}")
            success += 1
            
        except Exception as e:
            print(f"  [FAIL] {rel_path}: {e}")
            failed += 1
    
    print("-"*70)
    print(f"\nUpload complete: {success} success, {failed} failed")
    
    print("\n" + "="*70)
    print("SUCCESS!")
    print("="*70)
    print(f"\nRepository URL: https://github.com/{user.login}/{REPO_NAME}")
    print("\nNext steps:")
    print("  1. Add topic tags: emd, ceemdan, time-series, signal-processing")
    print("  2. Create Release: Releases → Create a new release → Tag: v1.0.0")

if __name__ == "__main__":
    main()
