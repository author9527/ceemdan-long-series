"""
GitHub Repository Creator and File Uploader
使用 PyGithub 库自动创建仓库并上传文件

使用前准备:
1. 安装依赖: pip install PyGithub
2. 获取 GitHub Personal Access Token:
   - 访问: https://github.com/settings/tokens
   - 点击 "Generate new token (classic)"
   - 选择 scope: repo (完全控制仓库)
   - 复制 token

使用方法:
python github_uploader.py --token YOUR_TOKEN --repo ceemdan-long-series
"""

import os
import sys
import argparse
from github import Github, InputFileContent
import base64

def upload_to_github(token: str, repo_name: str, description: str, local_dir: str):
    """
    创建GitHub仓库并上传文件
    
    Parameters:
    -----------
    token : str
        GitHub Personal Access Token
    repo_name : str
        仓库名称
    description : str
        仓库描述
    local_dir : str
        本地文件夹路径
    """
    
    # 连接 GitHub
    g = Github(token)
    user = g.get_user()
    
    # 检查仓库是否已存在
    try:
        repo = user.get_repo(repo_name)
        print(f"仓库已存在: https://github.com/{user.login}/{repo_name}")
        existing = True
    except:
        existing = False
    
    # 创建仓库 (如果不存在)
    if not existing:
        print(f"创建仓库: {repo_name}")
        try:
            repo = user.create_repo(
                name=repo_name,
                description=description,
                license_template="gpl-2.0",  # GPL v2
                auto_init=True
            )
            print(f"仓库创建成功: https://github.com/{user.login}/{repo_name}")
        except Exception as e:
            print(f"创建仓库失败: {e}")
            print("\n可能的原因:")
            print("  1. 仓库名已存在，请使用其他名称")
            print("  2. Token 权限不足")
            return
    else:
        repo = user.get_repo(repo_name)
    
    # 获取本地文件列表
    files_to_upload = []
    for root, dirs, files in os.walk(local_dir):
        # 跳过 .git 目录
        if '.git' in root:
            continue
        for file in files:
            filepath = os.path.join(root, file)
            rel_path = os.path.relpath(filepath, local_dir)
            files_to_upload.append(rel_path)
            print(f"  准备上传: {rel_path}")
    
    # 上传文件
    print(f"\n开始上传 {len(files_to_upload)} 个文件...")
    for rel_path in files_to_upload:
        filepath = os.path.join(local_dir, rel_path)
        try:
            with open(filepath, 'rb') as f:
                content = f.read()
            
            # 检查文件大小
            size_mb = len(content) / (1024 * 1024)
            if size_mb > 100:
                print(f"  跳过 {rel_path}: {size_mb:.1f}MB (超过100MB限制)")
                print(f"    建议: 使用 Git LFS 或通过 Release 上传")
                continue
            
            # 解码内容用于 GitHub API
            encoded_content = base64.b64encode(content).decode('utf-8')
            
            # 获取文件的 SHA (如果文件已存在)
            try:
                existing_file = repo.get_contents(rel_path)
                sha = existing_file.sha
            except:
                sha = None
            
            # 上传或更新文件
            if sha:
                result = repo.update_file(
                    path=rel_path,
                    message=f"Update {rel_path}",
                    content=encoded_content,
                    sha=sha
                )
                print(f"  更新: {rel_path}")
            else:
                result = repo.create_file(
                    path=rel_path,
                    message=f"Add {rel_path}",
                    content=encoded_content
                )
                print(f"  上传: {rel_path}")
                
        except Exception as e:
            print(f"  错误: {rel_path} - {e}")
    
    print(f"\n{'='*60}")
    print(f"完成! 仓库地址: https://github.com/{user.login}/{repo_name}")
    print(f"{'='*60}")
    
    # 打印后续步骤
    print("\n后续步骤:")
    print("  1. 访问仓库页面，添加主题标签:")
    print("     emd, ceemdan, time-series, signal-processing")
    print("  2. 创建 Release:")
    print("     Releases → Create a new release → Tag: v1.0.0")
    print("  3. 如果需要，设置 GitHub Pages")


def main():
    parser = argparse.ArgumentParser(
        description='上传文件到 GitHub',
        formatter_class=argparse.RawDescriptionHelpFormatter,
        epilog="""
示例:
  # 使用命令行参数
  python github_uploader.py --token ghp_xxxx --repo my-ceemdan
  
  # 或手动输入
  python github_uploader.py
        """
    )
    
    parser.add_argument('--token', '-t', 
                       help='GitHub Personal Access Token')
    parser.add_argument('--repo', '-r', 
                       default='ceemdan-long-series',
                       help='仓库名称 (默认: ceemdan-long-series)')
    parser.add_argument('--dir', '-d',
                       help='本地目录路径 (默认: 当前目录)')
    parser.add_argument('--description', '-d',
                       default='Extended CEEMDAN for long time-series analysis (13+ IMFs)',
                       help='仓库描述')
    
    args = parser.parse_args()
    
    # 获取 token
    if not args.token:
        args.token = os.environ.get('GITHUB_TOKEN', '')
    
    if not args.token:
        print("="*60)
        print("GitHub 上传工具")
        print("="*60)
        print("\n请提供 GitHub Personal Access Token:")
        print("获取方式: https://github.com/settings/tokens")
        print("  - 点击 'Generate new token (classic)'")
        print("  - 选择 scope: repo (完全控制仓库)")
        print("  - 复制 token")
        print()
        args.token = input("Token: ").strip()
    
    # 获取目录
    if not args.dir:
        args.dir = os.path.dirname(os.path.abspath(__file__))
        # 如果当前目录有 github_release 子目录，使用它
        if os.path.basename(args.dir) == 'github_release':
            args.dir = os.path.dirname(args.dir)
    
    print(f"\n本地目录: {args.dir}")
    print(f"仓库名称: {args.repo}")
    
    # 确认
    confirm = input("\n确认上传? (y/n): ").strip().lower()
    if confirm != 'y':
        print("已取消")
        return
    
    # 执行上传
    upload_to_github(args.token, args.repo, args.description, args.dir)


if __name__ == '__main__':
    main()
